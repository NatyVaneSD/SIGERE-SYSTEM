<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca de Requisições</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="top-bar">
        <span>Sistema de Cadastro</span> |
        <a href="/">Início</a> |
        <a href="/buscar">BUSCAR REQUISIÇÃO</a> |
        <a href="/gerencia">GERÊNCIA</a>
    </div>
    <div class="container">
        <h2>Busca de Requisições</h2>

        <div class="filtros-busca">
            <label for="numero_requisicao">Número da Requisição:</label>
            <input type="text" id="numero_requisicao" name="numero_requisicao">

            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="">Todos</option>
                <option value="EM ESPERA">EM ESPERA</option>
                <option value="EM ANDAMENTO">EM ANDAMENTO</option>
                <option value="FINALIZADO">FINALIZADO</option>
                <option value="CANCELADO">CANCELADO</option>
            </select>

            <label for="data_inicio">Data Início:</label>
            <input type="date" id="data_inicio" name="data_inicio">

            <label for="data_fim">Data Fim:</label>
            <input type="date" id="data_fim" name="data_fim">

            <button onclick="buscarRequisicoes()">Buscar</button>
        </div>

        
        <div class="tabela-resultados">
            <table id="tabela-requisicoes">
                <thead>
                    <tr>
                        <th>Número da Requisição</th>
                        <th>Tipo de Documento</th>
                        <th>Status</th>
                        <th>Data de Criação</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function buscarRequisicoes() {
            const numeroRequisicao = document.getElementById("numero_requisicao").value;
            const status = document.getElementById("status").value;
            const dataInicio = document.getElementById("data_inicio").value;
            const dataFim = document.getElementById("data_fim").value;

            
            fetch(`/buscar?numero_requisicao=${numeroRequisicao}&status=${status}&data_inicio=${dataInicio}&data_fim=${dataFim}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector("#tabela-requisicoes tbody");
                    tbody.innerHTML = ""; // Limpar resultados anteriores

                    // Preencher a tabela com os resultados
                    data.forEach(requisicao => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${requisicao.numero_requisicao}</td>
                            <td>${requisicao.tipo_documento}</td>
                            <td>${requisicao.status}</td>
                            <td>${requisicao.data_requisicao}</td>
                            <td>
                                <button onclick="editarRequisicao(${requisicao.id})">Editar</button>
                                <button onclick="verDetalhes(${requisicao.id})">Detalhes</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                });
        }

        function editarRequisicao(id) {
            // Redirecionar para a página de edição
            window.location.href = `/editar/${id}`;
        }

        function verDetalhes(id) {
            window.location.href = `/detalhes/${id}`;
        }
    </script>
</body>
</html>
